@page "/Explore"
@using Core
@using System.Security.Claims
@inject NavigationManager NavigationManager
@inject HttpClient Http
@inject AuthenticationStateProvider Auth
@inject AppState State

<div class="padding-div">
<PageTitle>Explore</PageTitle>

@if (projects == null)
{
    <p><em>Welcome! Log in to see projects.</em></p>

} else {
<h1>Available Projects</h1>

<p>Here is an overview of all the available projects and theses. For a better suited match, go to the Home page.</p>

<table class="table">
    <thead>
        <tr>
            <th>Project</th>
            <th>Supervisor</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var project in projects)
        {
        <tr>
            <td>@project.Name</td>
            <td>@project.SupervisorName</td>
            <td><button style="width:100px" class="btn button" @onclick="()=>View(project)">Details</button></td>
        </tr>
        }    
    </tbody>
</table>
}
</div>

@code{
private ProjectDTO[]? projects;

public int UserId {get; set;}

protected override async Task OnInitializedAsync()
    {
        if (!State.LoggedIn) {
        NavigationManager.NavigateTo($"{NavigationManager.BaseUri}home");
      }
            
        projects = await Http.GetFromJsonAsync<ProjectDTO[]>("api/Projects");
        
    }
    private void View(ProjectDTO project){
        var uri = $"{NavigationManager.BaseUri}details/{project.Id}";
        NavigationManager.NavigateTo(uri);

    }
}