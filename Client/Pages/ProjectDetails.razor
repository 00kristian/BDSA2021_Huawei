@page "/details/{projectId:int}"
@using Core
@inject NavigationManager NavigationManager
@inject HttpClient Http
@inject AppState State
@inject IJSRuntime JSRuntime

 <h1>@project.Name</h1>
 <h5 class ="detail"><b>Due date: </b>@project.DueDate.ToShortDateString()</h5>
 <h5 class ="detail"><b>Id: </b>@project.Id</h5>
 <h5 class ="detail"><b>Meeting day: </b>@project.Meetingday</h5>
 <h5 class ="detail"><b>Inteded work hours: </b>@workHours[@project.IntendedWorkHours]</h5>
 <h5 class ="detail"><b>Language: </b>@project.Language</h5>
 <h5 class ="detail"><b>Location: </b>@project.Location</h5>
 <h5 class ="detail"><b>Skill requirement: </b>@project.SkillRequirementDescription</h5>
 <h5 class ="detail"><b>Supervisor: </b>@project.SupervisorName</h5>
 <h5 class ="detail"><b>Format: </b>@(project.IsThesis ? "Thesis" : "Project")</h5>
 <table class='table'>
        <thead>
            <tr>
                <th><h5><b>Keywords</b></h5></th>
            </tr>
        </thead>
        <tbody>
            @foreach (string keyword in @project.Keywords)
            {
                <tr>
                    <td><h5>@keyword</h5></td>
                </tr>
            }
        </tbody>
    </table>
 <button class="btn button" @onclick="ApplyForProject">Apply for project</button>
 <button class="btn button" @onclick="Return">Back to projects</button>

 @code{
    [Parameter]
    public int ProjectId { get; set; }

    private ProjectDTO project;

    public int UserId {get; set;}

    private StudentDTO Student;

    string[] workHours = new string[]{"less than 15 hours", "between 15 and 25 hours", "over 25 hour"};

    protected override async Task OnInitializedAsync(){
        project.Keywords = new List<string>();

      if (!State.LoggedIn) {
        NavigationManager.NavigateTo($"{NavigationManager.BaseUri}home");
      }
        UserId = State.UserId;
        if (UserId != 0)
        {
            Student = await Http.GetFromJsonAsync<StudentDTO>($"api/Students/{UserId}");
        }
    }
    
    protected override async Task OnParametersSetAsync()
    {
        
        if (ProjectId != 0)
        {
            project = await Http.GetFromJsonAsync<ProjectDTO>($"api/Projects/{ProjectId}");
        }

        await base.OnParametersSetAsync();
    }

    private async void ApplyForProject(){
        Student.AppliedProjects.Add(project.Id);
        //await JSRuntime.InvokeAsync<object>("Alert", "Project applied for");
        await Http.PutAsJsonAsync($"api/Students/{UserId}", Student);
    }

     private void Return(){
         var uri = $"{NavigationManager.BaseUri}home";
        NavigationManager.NavigateTo(uri);
     }
}